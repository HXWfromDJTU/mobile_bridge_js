!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MobileBridge=t():e.MobileBridge=t()}(self,(function(){return(()=>{var e={666:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,s||e,i),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,o=[];if(0===this._eventsCount)return o;for(r in e=this._events)t.call(e,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,i=new Array(s);o<s;o++)i[o]=r[o].fn;return i},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,o,s,i){var a=n?n+e:e;if(!this._events[a])return!1;var u,c,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,o),!0;case 5:return l.fn.call(l.context,t,r,o,s),!0;case 6:return l.fn.call(l.context,t,r,o,s,i),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,o);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},a.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,o){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return i(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||o&&!a.once||r&&a.context!==r||i(this,s);else{for(var u=0,c=[],l=a.length;u<l;u++)(a[u].fn!==t||o&&!a[u].once||r&&a[u].context!==r)&&c.push(a[u]);c.length?this._events[s]=1===c.length?c[0]:c:i(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},970:(e,t,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,o="object"==typeof self&&self&&self.Object===Object&&self,s=r||o||Function("return this")(),i=Object.prototype,a=0,u=i.toString,c=s.Symbol,l=c?c.prototype:void 0,d=l?l.toString:void 0;e.exports=function(e){var t,n=++a;return(null==(t=e)?"":function(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return d?d.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t))+n}},4:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(666),i=n(312),a=n(275),u=n(807),c=n(803),l=n(6),d=n(970),f=function(e){function t(t){var n=e.call(this)||this;n.logger=window.console,n._promises=new Map,window[u.SDK_NAME]=n,n.apiDict=t||{},a.isIframeEnv()?(console.debug(u.SDK_NAME+".init: use IframeChannel"),n._channel=new i.IframeChannel,window.onmessage=function(e){n.logger.debug(u.SDK_NAME+"-iframe-receive message, ready to handle",e),e.data&&"string"==typeof e.data&&e.data.includes('"'+u.JSON_RPC_KEY+'":"'+u.JSON_RPC_VERSION+'"')&&n.response(e.data)}):(console.debug(u.SDK_NAME+".init: use NativeChannel"),n._channel=new l.NativeChannel(u.NativeSDKGlobalKey,console));for(var r=0,o=Object.keys(n.apiDict);r<o.length;r++){var s=o[r];n[s]=new n.apiDict[s](n)}return n._roundTripTimer=setInterval((function(){for(var e=0,t=n._promises.entries();e<t.length;e++){var r=t[e],o=(r[0],r[1]);(new Date).getTime()-o.createdAt.getTime()&&n.logger.warn(u.SDK_NAME+"-checking: request RTT is over "+u.EXPIRE_DURATION+", method: ",o.method)}}),u.HEARTBEAT_DURATION),n}return o(t,e),t.prototype.response=function(e){var t;try{t=JSON.parse(e),this.logger.debug(u.SDK_NAME+"-response receive:",e)}catch(t){return void this.logger.error(u.SDK_NAME+"-response parse data error.",e)}if(a.isNotify(t)){var n=t.id,r=t.data;return this.logger.debug(u.SDK_NAME+": receive notify",n),void this.emit(""+u.NOTIFY_PREFIX,r)}if(a.isRequest(t)){n=t.id;var o=t.method,s=t.params;return this.logger.debug(u.SDK_NAME+": receive request",n),void this.emit(u.NOTIFY_PREFIX+":"+o,s)}if(a.isResponse(t)){n=t.id;var i=t.errCode,l=t.data,d=t.errMsg,f=this._promises.get(n);if(!f)return void this.logger.error(u.SDK_NAME+"-response, no promise for this message",t);(new Date).getTime()-f.createdAt.getTime()>u.EXPIRE_DURATION&&this.logger.warn(u.SDK_NAME+"-response: receive response more than "+u.EXPIRE_DURATION+"s"),this._promises.delete(n),this.logger.debug(u.SDK_NAME+"-response, remove callback promise, id = "+n),i===c.RES_CODE.success?(this.logger.debug(u.SDK_NAME+"-response: response data",l),f.resolve.call(this,l)):(this.logger.debug(u.SDK_NAME+"-response: received error",d),f.reject.call(this,d))}},t.prototype.request=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(r,o){var s;e=Object.assign(e,((s={id:t?u.NOTIFY_PREFIX:d(u.SDK_NAME+"-")})[u.JSON_RPC_KEY]=u.JSON_RPC_VERSION,s)),t||(n.logger.debug(u.SDK_NAME+"-request add callback promise, id =",e.id),n._promises.set(e.id,{resolve:r,reject:o,method:e.method,createdAt:new Date})),n.logger.debug(u.SDK_NAME+"-request message send, payload =",e),n._channel.postMessage(e)}))},t}(s);t.default=f},347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPI=void 0;var n=function(){function e(e){this._bridge=e}return e.prototype._request=function(e,t){return void 0===t&&(t=!1),this._bridge.request(e,t)},e}();t.BaseAPI=n},601:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.sendTestMessage=function(){return this._request({method:"test_method",params:{}})},t.prototype.getAddressFromAddressBook=function(){return this._request({method:"getAddressFromAddressBook",params:{}})},t}(n(347).BaseAPI);t.default=s},49:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={testApi:n(601).default};t.default=r},312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IframeChannel=void 0;var n=function(){function e(){}return e.prototype.postMessage=function(e){window.parent.postMessage(e,"*")},e}();t.IframeChannel=n},6:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NativeChannel=void 0;var r=n(275),o=n(807),s=function(){function e(e,t){this.isIOS=!1,this.isAndroid=!1;var n=r.getAllUserAgent();this.logger=t,this.useChannelName=e,this.isIOS=n.ios,this.isAndroid=n.android}return e.prototype.postMessage=function(e){var t,n,r;if(this.logger.debug(o.SDK_NAME+"-NativeChannel send message",e),this.isAndroid){this.logger.debug(o.SDK_NAME+"-NativeChannel Android send message",e);var s=window[this.useChannelName];s&&s.postMessage?s.postMessage(e):this.logger.error(o.SDK_NAME+"-NativeChannel Android: bridge not found in window, name =",this.useChannelName)}else this.isIOS?(this.logger.debug(o.SDK_NAME+"-NativeChannel iOS send message",e),(null===(r=null===(n=null===(t=window.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n[this.useChannelName])||void 0===r?void 0:r.postMessage)?window.webkit.messageHandlers[this.useChannelName].postMessage(e):this.logger.error(o.SDK_NAME+"-NativeChannel iOS: bridge not found in messageHandlers, name =",this.useChannelName)):this.logger.error(o.SDK_NAME+"-NativeChannel platform not supported, userAgent = ",window.navigator.userAgent)},e.dataToString=function(e){return"string"==typeof e?e:JSON.stringify(e)},e}();t.NativeChannel=s},807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_DURATION=t.NOTIFY_PREFIX=t.EXPIRE_DURATION=t.JSON_RPC_KEY=t.JSON_RPC_VERSION=t.NativeSDKGlobalKey=t.TEST_API_KEY=t.SDK_NAME=void 0,t.SDK_NAME="MobileBridge",t.TEST_API_KEY="API_TEST",t.NativeSDKGlobalKey="MobileBridgeNative",t.JSON_RPC_VERSION="2.0",t.JSON_RPC_KEY="jsonrpc",t.EXPIRE_DURATION=3e3,t.NOTIFY_PREFIX="notify",t.HEARTBEAT_DURATION=1e3},803:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RES_CODE=void 0,t.RES_CODE={success:0}},275:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllUserAgent=t.isIframeEnv=t.isResponse=t.isNotify=t.isRequest=void 0;var r=n(807);t.isRequest=function(e){return["jsonrpc","id","method","params"].every((function(t){return e.hasOwnProperty(t)}))},t.isNotify=function(e){return["jsonrpc","id","data"].every((function(t){return e.hasOwnProperty(t)}))&&e.id===r.NOTIFY_PREFIX},t.isResponse=function(e){return["jsonrpc","id","errCode"].every((function(t){return e.hasOwnProperty(t)}))},t.isIframeEnv=function(){return window.self!==window.top},t.getAllUserAgent=function(){var e=window.navigator.userAgent.toLowerCase();return{android:e.includes("android"),ios:e.includes("iphone")||e.includes("ipad"),windows:e.includes("windows"),ubuntu:e.includes("ubuntu"),mac:e.includes("mac")}}},109:(e,t,n)=>{"use strict";var r=n(4),o=n(807),s=n(49);window[o.SDK_NAME]=r.default,window[o.TEST_API_KEY]=s.default,t.default=r.default}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}return n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(109)})().default}));
//# sourceMappingURL=mobile_bridge_js.umd.min.js.map