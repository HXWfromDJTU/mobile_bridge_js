!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MobileBridge=t():e.MobileBridge=t()}(self,(function(){return(()=>{var e={666:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function o(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,o,i,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new r(o,i||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,o,r=[];if(0===this._eventsCount)return r;for(o in e=this._events)t.call(e,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},a.prototype.emit=function(e,t,o,r,i,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],f=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,o),!0;case 4:return u.fn.call(u.context,t,o,r),!0;case 5:return u.fn.call(u.context,t,o,r,i),!0;case 6:return u.fn.call(u.context,t,o,r,i,s),!0}for(c=1,l=new Array(f-1);c<f;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var p,d=u.length;for(c=0;c<d;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),f){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,o);break;case 4:u[c].fn.call(u[c].context,t,o,r);break;default:if(!l)for(p=1,l=new Array(f-1);p<f;p++)l[p-1]=arguments[p];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,o,r){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||r&&!a.once||o&&a.context!==o||s(this,i);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||r&&!a[l].once||o&&a[l].context!==o)&&c.push(a[l]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},970:(e,t,n)=>{var o="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,r="object"==typeof self&&self&&self.Object===Object&&self,i=o||r||Function("return this")(),s=Object.prototype,a=0,l=s.toString,c=i.Symbol,u=c?c.prototype:void 0,f=u?u.toString:void 0;e.exports=function(e){var t,n=++a;return(null==(t=e)?"":function(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(e))return f?f.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t))+n}},434:function(e,t,n){var o,r;!function(i,s){"use strict";void 0===(r="function"==typeof(o=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(o){return"debug"===o&&(o="log"),typeof console!==t&&("trace"===o&&n?i:void 0!==console[o]?r(console,o):void 0!==console.log?r(console,"log"):e)}function a(t,n){for(var r=0;r<o.length;r++){var i=o[r];this[i]=r<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function l(e,n,o){return function(){typeof console!==t&&(a.call(this,n,o),this[e].apply(this,arguments))}}function c(e,t,n){return s(e)||l.apply(this,arguments)}function u(e,n,r){var i,s=this,l="loglevel";function u(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,o=n.indexOf(encodeURIComponent(l)+"=");-1!==o&&(e=/^([^;]+)/.exec(n.slice(o))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||c,s.getLevel=function(){return i},s.setLevel=function(n,r){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(i=n,!1!==r&&function(e){var n=(o[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}(n),a.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){u()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var f=u();null==f&&(f=null==n?"WARN":n),s.setLevel(f,!1)}var f=new u,p={};f.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new u(e,f.getLevel(),f.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=d),f},f.getLoggers=function(){return p},f.default=f,f})?o.call(t,n,t,e):o)||(e.exports=r)}()},4:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(666),s=n(312),a=n(434),l=n(275),c=n(807),u=n(803),f=n(6),p=n(970),d=function(e){function t(t){var n=e.call(this)||this;n.logger=a.getLogger(c.SDK_NAME),n._promises=new Map,n.apiDict=t||{},l.isIframeEnv()?(console.debug(c.SDK_NAME+".init: use IframeChannel"),n._channel=new s.IframeChannel(console),window.onmessage=function(e){n.logger.debug(c.SDK_NAME+"-iframe-receive message, ready to handle",e),e.data&&"string"==typeof e.data&&e.data.includes('"'+c.JSON_RPC_KEY+'":"'+c.JSON_RPC_VERSION+'"')&&n.response(e.data)}):(console.debug(c.SDK_NAME+".init: use NativeChannel"),n._channel=new f.NativeChannel(c.NativeSDKGlobalKey,console));for(var o=0,r=Object.keys(n.apiDict);o<r.length;o++){var i=r[o];n[i]=new n.apiDict[i](n)}return n._roundTripTimer=setInterval((function(){for(var e=0,t=n._promises.entries();e<t.length;e++){var o=t[e],r=(o[0],o[1]);(new Date).getTime()-r.createdAt.getTime()&&n.logger.warn(c.SDK_NAME+"-checking: request RTT is over "+c.EXPIRE_DURATION+", method: ",r.method)}}),c.HEARTBEAT_DURATION),n}return r(t,e),t.prototype.response=function(e){var t;try{t=JSON.parse(e),this.logger.debug(c.SDK_NAME+"-response receive:",e)}catch(t){return void this.logger.error(c.SDK_NAME+"-response parse data error.",e)}if(l.isNotify(t)){var n=t.id,o=t.event;return this.logger.debug(c.SDK_NAME+": receive "+o+" notify",n),void this.emit(c.NOTIFY_PREFIX+":"+o,e)}if(l.isRequest(t)){n=t.id;var r=t.method,i=t.params;return this.logger.debug(c.SDK_NAME+": receive request",n),void this.emit(c.NOTIFY_PREFIX+":"+r,i)}if(l.isResponse(t)){n=t.id;var s=t.errCode,a=t.data,f=t.errMsg,p=this._promises.get(n);if(!p)return void this.logger.error(c.SDK_NAME+"-response, no promise for this message",t);(new Date).getTime()-p.createdAt.getTime()>c.EXPIRE_DURATION&&this.logger.warn(c.SDK_NAME+"-response: receive response more than "+c.EXPIRE_DURATION+"s"),this._promises.delete(n),this.logger.debug(c.SDK_NAME+"-response, remove callback promise, id = "+n),s===u.RES_CODE.success?(this.logger.debug(c.SDK_NAME+"-response: response data",a),p.resolve.call(this,a)):(this.logger.debug(c.SDK_NAME+"-response: received error",f),p.reject.call(this,f))}},t.prototype.request=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(o,r){var i;e=Object.assign(e,((i={id:t?c.NOTIFY_PREFIX:p(c.SDK_NAME+"-")})[c.JSON_RPC_KEY]=c.JSON_RPC_VERSION,i)),t||(n.logger.debug(c.SDK_NAME+"-request add callback promise, id =",e.id),n._promises.set(e.id,{resolve:o,reject:r,method:e.method,createdAt:new Date})),n.logger.debug(c.SDK_NAME+"-request message will be sent, payload =",e),n._channel.postMessage(e)}))},t}(i);t.default=d},347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPI=void 0;var n=function(){function e(e){this._bridge=e}return e.prototype._request=function(e,t){return void 0===t&&(t=!1),this._bridge.request(e,t)},e}();t.BaseAPI=n},601:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.sendTestMessage=function(){return this._request({method:"test_method",params:{}})},t}(n(347).BaseAPI);t.default=i},49:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={testApi:n(601).default};t.default=o},312:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IframeChannel=void 0;var o=n(807),r=function(){function e(e){this.logger=e}return e.prototype.postMessage=function(e){this.logger.debug(o.SDK_NAME+"-try sending through IframeChannel"),window.parent.postMessage(e,"*")},e}();t.IframeChannel=r},6:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NativeChannel=void 0;var o=n(275),r=n(807),i=function(){function e(e,t){this.isIOS=!1,this.isAndroid=!1;var n=o.getAllUserAgent();this.logger=t,this.useChannelName=e,this.isIOS=n.ios,this.isAndroid=n.android}return e.prototype.postMessage=function(t){var n,o,i;if(this.isAndroid){this.logger.debug(r.SDK_NAME+"-try sending through Android NativeChannel",t);var s=window[this.useChannelName];s&&s.postMessage?s.postMessage(t):this.logger.error(r.SDK_NAME+"-NativeChannel Android: bridge not found in window, name =",this.useChannelName)}else if(this.isIOS)if(this.logger.debug(r.SDK_NAME+"-try sending through iOS NativeChannel",t),null===(i=null===(o=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||void 0===o?void 0:o[this.useChannelName])||void 0===i?void 0:i.postMessage)window.webkit.messageHandlers[this.useChannelName].postMessage(t);else{var a=document.createElement("iframe");a.setAttribute("src","mobile-bridge://"+this.useChannelName+"?data="+e.dataToString(t)),a.setAttribute("style","display: none"),document.body.appendChild(a),setTimeout((function(){document.body.removeChild(a)}),100)}else this.logger.error(r.SDK_NAME+"-NativeChannel platform not supported, userAgent = ",window.navigator.userAgent)},e.dataToString=function(e){return"string"==typeof e?e:JSON.stringify(e)},e}();t.NativeChannel=i},807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_DURATION=t.NOTIFY_PREFIX=t.EXPIRE_DURATION=t.JSON_RPC_KEY=t.JSON_RPC_VERSION=t.NativeSDKGlobalKey=t.TEST_API_KEY=t.SDK_NAME=void 0,t.SDK_NAME="MobileBridge",t.TEST_API_KEY="API_TEST",t.NativeSDKGlobalKey="MobileBridgeNative",t.JSON_RPC_VERSION="2.0",t.JSON_RPC_KEY="jsonrpc",t.EXPIRE_DURATION=3e3,t.NOTIFY_PREFIX="notify",t.HEARTBEAT_DURATION=1e3},803:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RES_CODE=void 0,t.RES_CODE={success:0}},275:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllUserAgent=t.isIframeEnv=t.isResponse=t.isNotify=t.isRequest=void 0,t.isRequest=function(e){return["jsonrpc","id","method","params"].every((function(t){return e.hasOwnProperty(t)}))},t.isNotify=function(e){return["jsonrpc","id","event"].every((function(t){return e.hasOwnProperty(t)}))},t.isResponse=function(e){return["jsonrpc","id","errCode"].every((function(t){return e.hasOwnProperty(t)}))},t.isIframeEnv=function(){return window.self!==window.top},t.getAllUserAgent=function(){var e=window.navigator.userAgent.toLowerCase();return{android:e.includes("android"),ios:e.includes("iphone")||e.includes("ipad"),windows:e.includes("windows"),ubuntu:e.includes("ubuntu"),mac:e.includes("mac")}}},109:(e,t,n)=>{"use strict";var o=n(4),r=n(807),i=n(49);window[r.SDK_NAME]=o.default,window[r.TEST_API_KEY]=i.default,t.default=o.default}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}return n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(109)})().default}));
//# sourceMappingURL=mobile_bridge_js.umd.min.js.map