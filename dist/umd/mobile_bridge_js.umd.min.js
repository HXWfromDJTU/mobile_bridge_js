!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mobile_bridge=t():e.mobile_bridge=t()}(self,(function(){return(()=>{var e={666:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new o(n,s||e,i),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],c]:e._events[u].push(c):(e._events[u]=c,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),c.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,i=new Array(s);o<s;o++)i[o]=n[o].fn;return i},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,o,s,i){var c=r?r+e:e;if(!this._events[c])return!1;var u,a,p=this._events[c],f=arguments.length;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),f){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,n),!0;case 4:return p.fn.call(p.context,t,n,o),!0;case 5:return p.fn.call(p.context,t,n,o,s),!0;case 6:return p.fn.call(p.context,t,n,o,s,i),!0}for(a=1,u=new Array(f-1);a<f;a++)u[a-1]=arguments[a];p.fn.apply(p.context,u)}else{var l,d=p.length;for(a=0;a<d;a++)switch(p[a].once&&this.removeListener(e,p[a].fn,void 0,!0),f){case 1:p[a].fn.call(p[a].context);break;case 2:p[a].fn.call(p[a].context,t);break;case 3:p[a].fn.call(p[a].context,t,n);break;case 4:p[a].fn.call(p[a].context,t,n,o);break;default:if(!u)for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];p[a].fn.apply(p[a].context,u)}}return!0},c.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,n,o){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return i(this,s),this;var c=this._events[s];if(c.fn)c.fn!==t||o&&!c.once||n&&c.context!==n||i(this,s);else{for(var u=0,a=[],p=c.length;u<p;u++)(c[u].fn!==t||o&&!c[u].once||n&&c[u].context!==n)&&a.push(c[u]);a.length?this._events[s]=1===a.length?a[0]:a:i(this,s)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,e.exports=c},970:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,o="object"==typeof self&&self&&self.Object===Object&&self,s=n||o||Function("return this")(),i=Object.prototype,c=0,u=i.toString,a=s.Symbol,p=a?a.prototype:void 0,f=p?p.toString:void 0;e.exports=function(e){var t,r=++c;return(null==(t=e)?"":function(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return f?f.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t))+r}},4:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(666),i=r(312),c=r(275),u=r(807),a=r(803),p=r(49),f=r(306),l=r(970),d=function(e){function t(){var t=e.call(this)||this;t.version=f.version,c.isIframeEnv()&&(t._channel=new i.IframeChannel,window.onmessage=function(e){e.data&&"string"==typeof e.data&&e.data.includes('"'+u.JSON_RPC_KEY+'":"'+u.JSON_RPC_VERSION+'"')&&t.response(e.data)});for(var r=0,n=Object.keys(p.default);r<n.length;r++){var o=n[r];t[o]=new p.default[o](t)}return t._roundTripTimer=setInterval((function(){for(var e=0,r=t._promises.entries();e<r.length;e++){var n=r[e],o=(n[0],n[1]);(new Date).getTime()-o.createdAt.getTime()&&t.logger.warn(u.SDK_NAME+"-checking: request RTT is over "+u.EXPIRE_DURATION+", method: ",o.method)}}),u.HEARTBEAT_DURATION),t}return o(t,e),t.prototype.response=function(e){var t;try{t=JSON.parse(e),this.logger.debug(u.SDK_NAME+"-response receive:",e)}catch(t){return void this.logger.error(u.SDK_NAME+"-response parse data error.",e)}if(c.isRequest(t)){var r=t.id,n=t.method,o=t.params;return this.logger.debug(u.SDK_NAME+"-response: notify",r),void this.emit(u.NOTIFY_PREFIX+":"+n,o)}if(c.isResponse(t)){r=t.id;var s=t.errCode,i=t.data,p=t.errMsg,f=this._promises.get(r);if(!f)return void this.logger.error(u.SDK_NAME+"-response, no promise for this message",t);(new Date).getTime()-f.createdAt.getTime()>u.EXPIRE_DURATION&&this.logger.warn(u.SDK_NAME+"-response: receive response more than "+u.EXPIRE_DURATION+"s"),this._promises.delete(r),this.logger.debug(u.SDK_NAME+"-response, remove callback promise, id = "+r),s===a.RES_CODE.success?(this.logger.error(u.SDK_NAME+"-response: response error",p),f.reject.call(this,p)):(this.logger.debug(u.SDK_NAME+"-response: received data",i),f.resolve.call(this,i))}},t.prototype.request=function(e,t){var r=this;return void 0===t&&(t=!1),new Promise((function(n,o){var s;e=Object.assign(e,((s={id:t?u.NOTIFY_PREFIX:l(""+u.SDK_NAME)})[u.JSON_RPC_KEY]=u.JSON_RPC_VERSION,s)),t||(r.logger.debug(u.SDK_NAME+"-request add callback promise, id =",e.id),r._promises.set(e.id,{resolve:n,reject:o,method:e.method,createdAt:new Date})),r.logger.debug(u.SDK_NAME+"-request message send, payload =",e),r._channel.postMessage(e)}))},t}(s);t.default=d},347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPI=void 0;var r=function(){function e(e){this._bridge=e}return e.prototype._request=function(e,t){return void 0===t&&(t=!1),this._bridge.request(e,t)},e}();t.BaseAPI=r},601:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.sendTestMessage=function(){return this._request({method:"test_method",params:{}})},t}(r(347).BaseAPI);t.default=s},49:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(601);t.default={TestModule:n.default}},312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IframeChannel=void 0;var r=function(){function e(){}return e.prototype.postMessage=function(e){window.parent.postMessage(e,"*")},e}();t.IframeChannel=r},807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_DURATION=t.NOTIFY_PREFIX=t.EXPIRE_DURATION=t.JSON_RPC_KEY=t.JSON_RPC_VERSION=t.SDK_NAME=void 0,t.SDK_NAME="Mobile_Bridge_JS",t.JSON_RPC_VERSION="2.0",t.JSON_RPC_KEY="jsonrpc",t.EXPIRE_DURATION=3e3,t.NOTIFY_PREFIX="notify",t.HEARTBEAT_DURATION=1e3},803:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RES_CODE=void 0,t.RES_CODE={success:0}},275:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isIframeEnv=t.isResponse=t.isRequest=t.isNotify=void 0,t.isNotify=function(e){return!0},t.isRequest=function(e){return["jsonrpc","id","method","params"].every((function(t){return e.hasOwnProperty(t)}))},t.isResponse=function(e){return["jsonrpc","id","errCode"].every((function(t){return e.hasOwnProperty(t)}))},t.isIframeEnv=function(){return window.self!==window.top}},109:(e,t,r)=>{"use strict";var n=new(r(4).default);t.default=n},306:e=>{"use strict";e.exports=JSON.parse('{"name":"mobile_bridge_js","version":"0.0.1","description":"","main":"index.js","dependencies":{"eventemitter3":"^4.0.7","lodash.uniqueid":"^4.0.1","loglevel":"^1.7.0","webpack":"^5.3.2"},"devDependencies":{"eventemitter3":"^4.0.7","html-webpack-plugin":"^4.5.0","lodash.uniqueid":"^4.0.1","ts-loader":"^8.0.7","typescript":"^4.0.5","webpack":"^5.3.0","webpack-bundle-analyzer":"^3.9.0","webpack-cli":"^4.1.0","webpack-merge":"^5.3.0"},"scripts":{"test":"echo \\"Error: no test specified\\" && exit 1","build":"npm run build:cjs && npm run build:esm && npm run build:umd","build:umd":"webpack --mode=production --config webpack.config.js","build:cjs":"tsc -p tsconfig.cjs.json","build:esm":"tsc -p tsconfig.esm.json"},"repository":{"type":"git","url":"git+https://github.com/HXWfromDJTU/mobile_bridge_js.git"},"author":"","license":"ISC","bugs":{"url":"https://github.com/HXWfromDJTU/mobile_bridge_js/issues"},"homepage":"https://github.com/HXWfromDJTU/mobile_bridge_js#readme"}')}},t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(109)})().default}));
//# sourceMappingURL=mobile_bridge_js.umd.min.js.map