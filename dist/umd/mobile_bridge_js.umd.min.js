!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MobileBridge=t():e.MobileBridge=t()}(self,(function(){return(()=>{var e={666:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function o(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,o,i,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");var c=new r(o,i||e,s),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],c]:e._events[u].push(c):(e._events[u]=c,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,o,r=[];if(0===this._eventsCount)return r;for(o in e=this._events)t.call(e,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},c.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},c.prototype.emit=function(e,t,o,r,i,s){var c=n?n+e:e;if(!this._events[c])return!1;var u,l,a=this._events[c],p=arguments.length;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),p){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,o),!0;case 4:return a.fn.call(a.context,t,o,r),!0;case 5:return a.fn.call(a.context,t,o,r,i),!0;case 6:return a.fn.call(a.context,t,o,r,i,s),!0}for(l=1,u=new Array(p-1);l<p;l++)u[l-1]=arguments[l];a.fn.apply(a.context,u)}else{var f,d=a.length;for(l=0;l<d;l++)switch(a[l].once&&this.removeListener(e,a[l].fn,void 0,!0),p){case 1:a[l].fn.call(a[l].context);break;case 2:a[l].fn.call(a[l].context,t);break;case 3:a[l].fn.call(a[l].context,t,o);break;case 4:a[l].fn.call(a[l].context,t,o,r);break;default:if(!u)for(f=1,u=new Array(p-1);f<p;f++)u[f-1]=arguments[f];a[l].fn.apply(a[l].context,u)}}return!0},c.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,o,r){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var c=this._events[i];if(c.fn)c.fn!==t||r&&!c.once||o&&c.context!==o||s(this,i);else{for(var u=0,l=[],a=c.length;u<a;u++)(c[u].fn!==t||r&&!c[u].once||o&&c[u].context!==o)&&l.push(c[u]);l.length?this._events[i]=1===l.length?l[0]:l:s(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,e.exports=c},970:(e,t,n)=>{var o="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,r="object"==typeof self&&self&&self.Object===Object&&self,i=o||r||Function("return this")(),s=Object.prototype,c=0,u=s.toString,l=i.Symbol,a=l?l.prototype:void 0,p=a?a.toString:void 0;e.exports=function(e){var t,n=++c;return(null==(t=e)?"":function(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return p?p.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t))+n}},434:function(e,t,n){var o,r;!function(i,s){"use strict";void 0===(r="function"==typeof(o=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(o){return"debug"===o&&(o="log"),typeof console!==t&&("trace"===o&&n?i:void 0!==console[o]?r(console,o):void 0!==console.log?r(console,"log"):e)}function c(t,n){for(var r=0;r<o.length;r++){var i=o[r];this[i]=r<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function u(e,n,o){return function(){typeof console!==t&&(c.call(this,n,o),this[e].apply(this,arguments))}}function l(e,t,n){return s(e)||u.apply(this,arguments)}function a(e,n,r){var i,s=this,u="loglevel";function a(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,o=n.indexOf(encodeURIComponent(u)+"=");-1!==o&&(e=/^([^;]+)/.exec(n.slice(o))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||l,s.getLevel=function(){return i},s.setLevel=function(n,r){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(i=n,!1!==r&&function(e){var n=(o[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),c.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){a()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var p=a();null==p&&(p=null==n?"WARN":n),s.setLevel(p,!1)}var p=new a,f={};p.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=f[e];return t||(t=f[e]=new a(e,p.getLevel(),p.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return p.noConflict=function(){return typeof window!==t&&window.log===p&&(window.log=d),p},p.getLoggers=function(){return f},p.default=p,p})?o.call(t,n,t,e):o)||(e.exports=r)}()},4:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(666),s=n(312),c=n(434),u=n(275),l=n(807),a=n(803),p=n(49),f=n(306),d=n(970),v=function(e){function t(){var t=e.call(this)||this;t.logger=c.getLogger("MobileBridge"),t.version=f.version,t._promises=new Map,u.isIframeEnv()&&(t._channel=new s.IframeChannel,window.onmessage=function(e){e.data&&"string"==typeof e.data&&e.data.includes('"'+l.JSON_RPC_KEY+'":"'+l.JSON_RPC_VERSION+'"')&&t.response(e.data)});for(var n=0,o=Object.keys(p.default);n<o.length;n++){var r=o[n];t[r]=new p.default[r](t)}return t._roundTripTimer=setInterval((function(){for(var e=0,n=t._promises.entries();e<n.length;e++){var o=n[e],r=(o[0],o[1]);(new Date).getTime()-r.createdAt.getTime()&&t.logger.warn(l.SDK_NAME+"-checking: request RTT is over "+l.EXPIRE_DURATION+", method: ",r.method)}}),l.HEARTBEAT_DURATION),t}return r(t,e),t.prototype.response=function(e){var t;try{t=JSON.parse(e),this.logger.debug(l.SDK_NAME+"-response receive:",e)}catch(t){return void this.logger.error(l.SDK_NAME+"-response parse data error.",e)}if(u.isRequest(t)){var n=t.id,o=t.method,r=t.params;return this.logger.debug(l.SDK_NAME+"-response: notify",n),void this.emit(l.NOTIFY_PREFIX+":"+o,r)}if(u.isResponse(t)){n=t.id;var i=t.errCode,s=t.data,c=t.errMsg,p=this._promises.get(n);if(!p)return void this.logger.error(l.SDK_NAME+"-response, no promise for this message",t);(new Date).getTime()-p.createdAt.getTime()>l.EXPIRE_DURATION&&this.logger.warn(l.SDK_NAME+"-response: receive response more than "+l.EXPIRE_DURATION+"s"),this._promises.delete(n),this.logger.debug(l.SDK_NAME+"-response, remove callback promise, id = "+n),i===a.RES_CODE.success?(this.logger.error(l.SDK_NAME+"-response: response error",c),p.reject.call(this,c)):(this.logger.debug(l.SDK_NAME+"-response: received data",s),p.resolve.call(this,s))}},t.prototype.request=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(o,r){var i;e=Object.assign(e,((i={id:t?l.NOTIFY_PREFIX:d(""+l.SDK_NAME)})[l.JSON_RPC_KEY]=l.JSON_RPC_VERSION,i)),t||(n.logger.debug(l.SDK_NAME+"-request add callback promise, id =",e.id),n._promises.set(e.id,{resolve:o,reject:r,method:e.method,createdAt:new Date})),n.logger.debug(l.SDK_NAME+"-request message send, payload =",e),n._channel.postMessage(e)}))},t}(i);t.default=v},347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPI=void 0;var n=function(){function e(e){this._bridge=e}return e.prototype._request=function(e,t){return void 0===t&&(t=!1),this._bridge.request(e,t)},e}();t.BaseAPI=n},601:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.sendTestMessage=function(){return this._request({method:"test_method",params:{}})},t}(n(347).BaseAPI);t.default=i},49:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(601);t.default={TestModule:o.default}},312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IframeChannel=void 0;var n=function(){function e(){}return e.prototype.postMessage=function(e){window.parent.postMessage(e,"*")},e}();t.IframeChannel=n},807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_DURATION=t.NOTIFY_PREFIX=t.EXPIRE_DURATION=t.JSON_RPC_KEY=t.JSON_RPC_VERSION=t.SDK_NAME=void 0,t.SDK_NAME="Mobile_Bridge_JS",t.JSON_RPC_VERSION="2.0",t.JSON_RPC_KEY="jsonrpc",t.EXPIRE_DURATION=3e3,t.NOTIFY_PREFIX="notify",t.HEARTBEAT_DURATION=1e3},803:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RES_CODE=void 0,t.RES_CODE={success:0}},275:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isIframeEnv=t.isResponse=t.isRequest=t.isNotify=void 0,t.isNotify=function(e){return!0},t.isRequest=function(e){return["jsonrpc","id","method","params"].every((function(t){return e.hasOwnProperty(t)}))},t.isResponse=function(e){return["jsonrpc","id","errCode"].every((function(t){return e.hasOwnProperty(t)}))},t.isIframeEnv=function(){return window.self!==window.top}},109:(e,t,n)=>{"use strict";var o=new(n(4).default);t.default=o},306:e=>{"use strict";e.exports=JSON.parse('{"name":"mobile_bridge_js","version":"0.0.1","description":"","main":"index.js","dependencies":{"eventemitter3":"^4.0.7","lodash.uniqueid":"^4.0.1","loglevel":"^1.7.0","webpack":"^5.3.2"},"devDependencies":{"eventemitter3":"^4.0.7","html-webpack-plugin":"^4.5.0","lodash.uniqueid":"^4.0.1","open-browser-webpack-plugin":"^0.0.5","ts-loader":"^8.0.7","typescript":"^4.0.5","webpack":"^5.3.0","webpack-bundle-analyzer":"^3.9.0","webpack-cli":"^4.1.0","webpack-merge":"^5.3.0"},"scripts":{"test":"echo \\"Error: no test specified\\" && exit 1","build":"npm run build:cjs && npm run build:esm && npm run build:umd","build:umd":"webpack --mode=production --config webpack.config.js","build:cjs":"tsc -p tsconfig.cjs.json","build:esm":"tsc -p tsconfig.esm.json"},"repository":{"type":"git","url":"git+https://github.com/HXWfromDJTU/mobile_bridge_js.git"},"author":"","license":"ISC","bugs":{"url":"https://github.com/HXWfromDJTU/mobile_bridge_js/issues"},"homepage":"https://github.com/HXWfromDJTU/mobile_bridge_js#readme"}')}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}return n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(109)})().default}));
//# sourceMappingURL=mobile_bridge_js.umd.min.js.map